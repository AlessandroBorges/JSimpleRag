# ======================================
# JSimpleRag Application Configuration
# ======================================

# Application Info
spring.application.name=jsimplerag
server.port=8080

# ======================================
# Database Configuration
# ======================================
# Note: Eclipse doesn't load .env automatically, using defaults from .env file
# Using rag_rw (table owner) instead of rag_user for full permissions
spring.datasource.url=jdbc:postgresql://${DB_HOST:alessandro-X99}:${DB_PORT:5432}/${DB_NAME:db_rag}
spring.datasource.username=${DB_USERNAME:rag_rw}
spring.datasource.password=${DB_PASSWORD:pass123}
spring.datasource.driver-class-name=org.postgresql.Driver

# Explicit JDBC URL for Liquibase (required in some environments)
spring.datasource.jdbc-url=${spring.datasource.url}

# JPA/Hibernate Configuration - Database First with Liquibase
# ddl-auto options: create, create-drop, update, validate, none
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Disable JPA DDL generation (Liquibase handles schema)
spring.jpa.generate-ddl=false
spring.jpa.defer-datasource-initialization=false

# Connection Pool (HikariCP)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.pool-name=RagHikariPool

# ======================================
# Liquibase Configuration
# ======================================
# Liquibase manages database schema (Database First approach)
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.xml
spring.liquibase.enabled=${LIQUIBASE_ENABLED:true}
spring.liquibase.drop-first=false

# ======================================
# LLM Service Provider Configuration
# ======================================

# Primary LLM Provider
llmservice.provider.name=${LLM_PROVIDER_CLASS:LM_STUDIO}
llmservice.provider.use_defaults=${LLM_PROVIDER_USE_DEFAULTS:true}
llmservice.provider.llm.models=${LLM_MODELS:qwen/qwen3-1.7b}
llmservice.provider.embedding.model=${EMBEDDING_MODEL:text-embedding-snowflake-arctic-embed-l-v2.0}
llmservice.provider.embedding.dimension=${EMBEDDING_DIMENSION:768}
llmservice.provider.api.url=${LLM_API_URL:http://alessandro-X99:1234/v1}
llmservice.provider.api.key=${LLM_API_KEY:LM_STUDIO_API_KEY}
llmservice.provider.embedding.embeddingContextLength=8192


# Secondary Provider (Optional - for backup/complement)
llmservice.provider2.enabled=${LLM_PROVIDER2_ENABLED:true}
llmservice.provider2.name=${LLM_PROVIDER2_CLASS:OLLAMA}
llmservice.provider2.use_defaults=${LLM_PROVIDER_USE_DEFAULTS:true}
llmservice.provider2.llm.models=${LLM_PROVIDER2_MODELS:qwen3:1.7b-q8_0}
llmservice.provider2.embedding.model=${LLM_PROVIDER2_EMBEDDING_MODEL:Definity/snowflake-arctic-embed-l-v2.0-q8_0:}
llmservice.provider2.embedding.dimension=${LLM_PROVIDER2_EMBEDDING_DIMENSION:768}
llmservice.provider2.api.url=${LLM_PROVIDER2_API_URL:http://alessandro-X99:11435/v1}
llmservice.provider2.api.key=${LLM_PROVIDER2_API_KEY:OLLAMA_API_KEY}
llmservice.provider2.embedding.embeddingContextLength=8192

# Strategy Configuration
# Supported strategies: PRIMARY_ONLY, FAILOVER, ROUND_ROBIN, SPECIALIZED, DUAL_VERIFICATION, SMART_ROUTING
llmservice.strategy=${LLM_STRATEGY:FAILOVER}
llmservice.failover.max-retries=${LLM_MAX_RETRIES:3}
llmservice.failover.timeout-seconds=${LLM_TIMEOUT_SECONDS:30}


# ======================================
# RAG Configuration
# ======================================

# Document Processing
rag.processamento.chunk-size-maximo=${CHUNK_SIZE_MAX:2000}
rag.processamento.capitulo-size-padrao=${CHAPTER_SIZE_DEFAULT:8000}

# Asynchronous Processing
rag.processamento.async.core-pool-size=${ASYNC_CORE_POOL:2}
rag.processamento.async.max-pool-size=${ASYNC_MAX_POOL:5}
rag.processamento.async.queue-capacity=${ASYNC_QUEUE_CAPACITY:100}
rag.processamento.async.schedule.fixed-delay=${ASYNC_SCHEDULE_DELAY:300000}

# Embedding Generation
rag.embedding.batch-size=${EMBEDDING_BATCH_SIZE:100}
rag.embedding.timeout-seconds=${EMBEDDING_TIMEOUT:30}

# Search Configuration
rag.pesquisa.default.peso-semantico=${DEFAULT_SEMANTIC_WEIGHT:0.60}
rag.pesquisa.default.peso-textual=${DEFAULT_TEXTUAL_WEIGHT:0.40}
rag.pesquisa.default.limite=${DEFAULT_SEARCH_LIMIT:10}

# ======================================
# OpenAPI/Swagger Configuration
# ======================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha

# API Documentation Info
springdoc.info.title=JSimpleRag API
springdoc.info.description=Hierarchical RAG System with Hybrid Search
springdoc.info.version=0.0.1-SNAPSHOT
springdoc.info.contact.name=JSimpleRag Team
springdoc.info.license.name=MIT License

# ======================================
# Logging Configuration
# ======================================
logging.level.bor.tools.simplerag=${LOG_LEVEL:DEBUG}
logging.level.org.springframework.web=${WEB_LOG_LEVEL:INFO}
logging.level.org.hibernate.SQL=${SQL_LOG_LEVEL:DEBUG}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${HIBERNATE_BINDER_LOG:TRACE}
logging.level.liquibase=${LIQUIBASE_LOG_LEVEL:INFO}

# Log Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %level - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Log File (if needed)
#logging.file.name=logs/jsimplerag.log
#logging.file.max-size=10MB
#logging.file.max-history=30

# ======================================
# Actuator/Monitoring Configuration
# ======================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true

# ======================================
# JSON Configuration
# ======================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=America/Sao_Paulo

# ======================================
# Validation Configuration
# ======================================
spring.mvc.throw-exception-if-no-handler-found=true
spring.web.resources.add-mappings=false

# ======================================
# Development Profile Specific
# ======================================
# These will be overridden in application-dev.properties, application-prod.properties, etc.